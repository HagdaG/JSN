<%# app/views/admin/messages/index.html.erb %>

<div class="container mx-auto mt-10 p-6 bg-white rounded-lg shadow-xl text-gray-800">
  <h1 class="text-4xl font-extrabold mb-8 text-purple-medium text-center">
    Painel Administrativo JSN - Gerenciamento de Mensagens
  </h1>

  <% if notice %>
    <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4" role="alert">
      <%= notice %>
    </div>
  <% end %>
  <% if alert %>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
      <%= alert %>
    </div>
  <% end %>

  <div class="mb-10">
    <h2 class="text-2xl font-bold mb-4 text-pink-neon">Mensagens Pendentes (<%= @pending_messages.count %>)</h2>
    <% if @pending_messages.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200">
          <thead>
            <tr>
              <th class="py-2 px-4 border-b text-left">Conteúdo</th>
              <th class="py-2 px-4 border-b text-left">Enviado por</th>
              <th class="py-2 px-4 border-b text-left">Data de Envio</th>
              <th class="py-2 px-4 border-b text-center">Status</th>
              <th class="py-2 px-4 border-b text-center">Ações</th>
            </tr>
          </thead>
          <tbody>
            <% @pending_messages.each do |message| %>
              <tr class="<%= cycle('bg-gray-50', 'bg-white') %>">
                <td class="py-2 px-4 border-b"><%= message.content.truncate(50) %></td>
                <td class="py-2 px-4 border-b"><%= message.user_name.presence || 'Anônimo' %></td>
                <td class="py-2 px-4 border-b"><%= l message.created_at, format: :short %></td>
                <td class="py-2 px-4 border-b text-center capitalize"><%= message.status %></td>
                <td class="py-2 px-4 border-b text-center whitespace-nowrap">
                  <%# Botão de Aprovar (Visto Verde) %>
                  <%= button_to approve_admin_message_path(message), method: :patch, data: { turbo: true },
                                class: 'inline-block text-green-500 hover:text-green-700 transition-colors duration-200' do %>
                    <i class="fas fa-check-circle text-xl"></i>
                  <% end %>
                  <%# Botão de Rejeitar (X Vermelho) %>
                  <%= button_to reject_admin_message_path(message), method: :patch, data: { turbo: true },
                                class: 'inline-block text-red-500 hover:text-red-700 transition-colors duration-200 ml-2' do %>
                    <i class="fas fa-times-circle text-xl"></i>
                  <% end %>
                  <%# Botão de Excluir (Lixeira Vermelha) %>
                  <%= button_to admin_message_path(message), method: :delete, data: { turbo_confirm: 'Tem certeza que deseja excluir esta mensagem?' },
                                class: 'inline-block text-gray-500 hover:text-gray-700 transition-colors duration-200 ml-2' do %>
                    <i class="fas fa-trash-alt text-lg"></i>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-gray-600">Nenhuma mensagem pendente no momento.</p>
    <% end %>
  </div>

  <hr class="border-t-2 border-gray-300 my-10">

  <div class="mb-10">
    <h2 class="text-2xl font-bold mb-4 text-green-600">Mensagens Aprovadas (<%= @approved_messages.count %>)</h2>
    <% if @approved_messages.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200">
          <thead>
            <tr>
              <th class="py-2 px-4 border-b text-left">Conteúdo</th>
              <th class="py-2 px-4 border-b text-left">Enviado por</th>
              <th class="py-2 px-4 border-b text-left">Data de Aprovação</th>
              <th class="py-2 px-4 border-b text-center">Ações</th>
            </tr>
          </thead>
          <tbody>
            <% @approved_messages.each do |message| %>
              <tr class="<%= cycle('bg-gray-50', 'bg-white') %>">
                <td class="py-2 px-4 border-b"><%= message.content.truncate(50) %></td>
                <td class="py-2 px-4 border-b"><%= message.user_name.presence || 'Anônimo' %></td>
                <td class="py-2 px-4 border-b"><%= l message.updated_at, format: :short %></td>
                <td class="py-2 px-4 border-b text-center whitespace-nowrap">
                  <%# Botão de Rejeitar (X Vermelho) %>
                  <%= button_to reject_admin_message_path(message), method: :patch, data: { turbo: true },
                                class: 'inline-block text-red-500 hover:text-red-700 transition-colors duration-200' do %>
                    <i class="fas fa-times-circle text-xl"></i>
                  <% end %>
                  <%# Botão de Excluir (Lixeira Vermelha) %>
                  <%= button_to admin_message_path(message), method: :delete, data: { turbo_confirm: 'Tem certeza que deseja excluir esta mensagem?' },
                                class: 'inline-block text-gray-500 hover:text-gray-700 transition-colors duration-200 ml-2' do %>
                    <i class="fas fa-trash-alt text-lg"></i>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-gray-600">Nenhuma mensagem aprovada ainda.</p>
    <% end %>
  </div>

  <hr class="border-t-2 border-gray-300 my-10">

  <div>
    <h2 class="text-2xl font-bold mb-4 text-red-600">Mensagens Rejeitadas (<%= @rejected_messages.count %>)</h2>
    <% if @rejected_messages.any? %>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white border border-gray-200">
          <thead>
            <tr>
              <th class="py-2 px-4 border-b text-left">Conteúdo</th>
              <th class="py-2 px-4 border-b text-left">Enviado por</th>
              <th class="py-2 px-4 border-b text-left">Data de Rejeição</th>
              <th class="py-2 px-4 border-b text-center">Ações</th>
            </tr>
          </thead>
          <tbody>
            <% @rejected_messages.each do |message| %>
              <tr class="<%= cycle('bg-gray-50', 'bg-white') %>">
                <td class="py-2 px-4 border-b"><%= message.content.truncate(50) %></td>
                <td class="py-2 px-4 border-b"><%= message.user_name.presence || 'Anônimo' %></td>
                <td class="py-2 px-4 border-b"><%= l message.updated_at, format: :short %></td>
                <td class="py-2 px-4 border-b text-center whitespace-nowrap">
                  <%# Botão de Aprovar (Visto Verde) %>
                  <%= button_to approve_admin_message_path(message), method: :patch, class: 'inline-block text-green-500 hover:text-green-700 transition-colors duration-200' do %>
                    <i class="fas fa-check-circle text-xl"></i>
                  <% end %>
                  <%# Botão de Excluir (Lixeira Vermelha) %>
                  <%= button_to admin_message_path(message), method: :delete, data: { turbo_confirm: 'Tem certeza que deseja excluir esta mensagem?' },
                                class: 'inline-block text-gray-500 hover:text-gray-700 transition-colors duration-200 ml-2' do %>
                    <i class="fas fa-trash-alt text-lg"></i>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-gray-600">Nenhuma mensagem rejeitada ainda.</p>
    <% end %>
  </div>

  <div class="text-center mt-12">
    <%= link_to 'Voltar para o Painel Principal', admin_dashboard_path, class: 'bg-purple-dark hover:bg-purple-medium text-white font-bold py-2 px-4 rounded' %>
  </div>
</div>