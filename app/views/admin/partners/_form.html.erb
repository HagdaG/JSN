<%# app/views/admin/partners/_form.html.erb %>

<%= form_with(model: [:admin, @admin_user], url: @admin_user.persisted? ? admin_partner_path(@admin_user) : admin_partners_path, class: "space-y-4", html: { multipart: true }) do |f| %> <%# CORRIGIDO AQUI! %>
  <%= render "devise/shared/error_messages", resource: f.object %>

  <div>
    <%= f.label :name, "Nome:", class: "block text-sm font-medium text-admin-text" %>
    <%= f.text_field :name, autofocus: true, autocomplete: "name", class: "mt-1 block w-full rounded-md shadow-sm bg-admin-sidebar border-gray-600 text-white focus:ring-admin-accent focus:border-admin-accent" %>
  </div>

  <div>
    <%= f.label :email, class: "block text-sm font-medium text-admin-text" %>
    <%= f.email_field :email, autocomplete: "email", class: "mt-1 block w-full rounded-md shadow-sm bg-admin-sidebar border-gray-600 text-white focus:ring-admin-accent focus:border-admin-accent" %>
  </div>

  <div>
    <%= f.label :password, "Nova Senha (deixe em branco se não quiser mudar):", class: "block text-sm font-medium text-admin-text" %>
    <%= f.password_field :password, autocomplete: "new-password", class: "mt-1 block w-full rounded-md shadow-sm bg-admin-sidebar border-gray-600 text-white focus:ring-admin-accent focus:border-admin-accent" %>
    <% if @minimum_password_length %>
      <em class="text-sm text-gray-400"><%= @minimum_password_length %> caracteres mínimo</em>
    <% end %>
  </div>

  <div>
    <%= f.label :password_confirmation, "Confirme a Nova Senha:", class: "block text-sm font-medium text-admin-text" %>
    <%= f.password_field :password_confirmation, autocomplete: "new-password", class: "mt-1 block w-full rounded-md shadow-sm bg-admin-sidebar border-gray-600 text-white focus:ring-admin-accent focus:border-admin-accent" %>
  </div>

  <div>
    <%= f.label :photo, "Foto de Perfil:", class: "block text-sm font-medium text-admin-text" %>
    <% if f.object.photo.attached? %>
      <%= image_tag f.object.photo, class: "w-24 h-24 object-cover rounded-full mb-2" %>
    <% end %>
    <%= f.file_field :photo, class: "mt-1 block w-full text-sm text-admin-text file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-admin-accent file:text-white hover:file:bg-admin-accent-dark" %>
  </div>

  <%# Apenas o admin principal pode alterar este status para outros admins %>
  <% if current_admin_user.is_principal? && current_admin_user != f.object %>
    <div>
      <%= f.label :is_principal, class: "inline-flex items-center" do %>
        <%= f.check_box :is_principal, class: "rounded border-gray-300 text-admin-accent shadow-sm focus:ring-admin-accent" %>
        <span class="ml-2 text-sm text-admin-text">Admin Principal?</span>
      <% end %>
    </div>
  <% end %>

  <div class="actions">
    <%= f.submit "Salvar Colaborador", class: "bg-admin-accent hover:bg-admin-text text-white font-bold py-2 px-4 rounded-md transition duration-300 cursor-pointer" %>
    <%= link_to 'Voltar', admin_partners_path, class: 'ml-4 text-admin-text hover:underline' %>
  </div>
<% end %>